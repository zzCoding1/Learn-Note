## 3.fastDFS

 

### 3.1 fastDFS介绍

1. fastDFS 概述

   > * 用**C语言** 编写
   > * 充分考虑冗余备份、负载均衡、线性扩容、高可用、高性能
   >   * 冗余备份：纵向扩容
   >   * 线性扩容：横向扩容
   > * 可以很容易搭建一套高性能服务器集群，提供文件**上传**、 **下载**等服务。
   >   * 图床
   >   * 网盘

2. fastDFS框架中的三个角色（**进程**）

   - 追踪器（**Tracker**） - 管理者（**守护进程**：周期性执行某个任务）
     - 管理存储节点
   - 存储节点 - storage （**守护进程**）
     - 存储节点是有多个的
   - 客户端 - 不是守护进程，由程序员编写的程序
     - 文件上传
     - 文件下载

   ```mermaid
   sequenceDiagram
   Storgae Server -->> Tracker Server : 1.定时向tracker上传状态信息
   Client ->> Tracker Server : 2.下载连接请求
   Tracker Server ->> Tracker Server : 3.查询可用Storage（检查同步状态）
   Tracker Server -->> Client : 4.返回信息（storage的ip端口）
   Client ->> Storgae Server : 5.file_id(组名，路径，文件名)
   Storgae Server -->> Client : 6.返回file_content
   ```

   1. 追踪器
      - 最先启动追踪器
   2. 存储节点
   
       - 第二个启动的角色
       - 存储节点启动后，会单独开一个县城
         - 汇报当前存储节点的容量，和剩余的容量。
         - 汇报数据的同步情况
         - 汇报数据被下载的次数
     3. 客户端
        - 最后启动 
          - 上传
            - 连接追踪器，询问存储节点的信息。
              - 我要上传1G的文件，哪个存储节点有足够的容量
              - 追踪器查询，得到结果
              - 追踪器将存储节点的**IP**和**Port**发送给客户端
              - 通过**IP**和**Port**连接存储节点
              - 将文件内容发送给存储节点
          - 下载
            - 连接追踪器，询问存储节点信息
              - 问一下，要下载的文件在哪个存储节点
              - 追踪器查询，得到结果
              - 追踪器将存储节点的**IP**和**Port**发送给客户端
              - 通过**IP**和**Port**连接存储节点
              - 下载文件
     4. fastDFS集群（了解即可）
   
       ![image-20220704234229126](assets/%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/image-20220704234229126.png)
   
       1. 追踪器集群
          - 为什么集群
            - 避免单点故障

